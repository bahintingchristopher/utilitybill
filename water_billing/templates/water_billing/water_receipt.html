{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Receipt - {{ bill.tenant_name }}</title>
    <style>
        /* 1. GENERAL STYLES (Screen View) */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .receipt-container {
            max-width: 800px; /* Wider for screen viewing */
            margin: auto;
            background: #fff;
            padding: 30px;
            border-top: 10px solid #3498db;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h2 { margin: 0; color: #333; }
        .text-muted { color: #777; font-size: 14px; }
        .table-main { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .table-main td { padding: 10px 0; border-bottom: 1px solid #f9f9f9; }
        
        .reading-box {
            background-color: #eef7fd;
            padding: 20px;
            border: 1px solid #3498db;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .total-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #3498db;
            display: flex;
            justify-content: space-between;
            font-size: 24px;
            font-weight: bold;
            color: #2980b9;
        }

        .btn-container {
            text-align: center;
            margin-top: 30px;
        }

        .print-button {
            padding: 12px 25px;
            background: #3498db;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        /* 2. PRINT STYLES */
        @media print {
            @page {
                size: A4 portrait;
                margin: 0; /* Removes browser header/footer dates */
            }

            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .no-print {
                display: none ;
            }

            .receipt-container {
                width: 100% ;
                max-width: none ;
                height: 50vh ; /* Forces height to exactly half-page */
                margin: 0 ;
                padding: 40px ; /* Extra padding for paper margins */
                border-radius: 0 ;
                box-shadow: none ;
                border-top: 15px solid #3498db;
                box-sizing: border-box;
                position: relative;
            }

            .receipt-container p {
                text-align: left;
            }

        }
    </style>
</head>
<body>

    <div class="receipt-container">
        <div style="text-align: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 25px;">
            <h2>üíß WATER BILL</h2>
            <p class="text-muted">Date: {{ bill.billing_date|date:"M d, Y" }}</p>
        </div>

        <table class="table-main">
            <tr>
                <td style="color: #666;">Tenant:</td>
                <td style="text-align: right; font-weight: bold;">{{ bill.tenant_name }}</td>
            </tr>
            <tr>
                <td style="color: #666;">Room Number:</td>
                <td style="text-align: right; font-weight: bold;">{{ bill.room_number }}</td>
            </tr>
            <tr>
                <td style="color: #666;">Billing Period:</td>
                <td style="text-align: right; font-weight: bold;">
                    {{ bill.billing_period|date:"F Y"|default:"None" }}
                </td>
            </tr>
        </table>

        <div class="reading-box">
            <table style="width: 100%; border-collapse: collapse;">
                <tr><td>Present Reading:</td><td style="text-align: right;">{{ bill.current_reading }} m¬≥</td></tr>
                <tr><td>Previous Reading:</td><td style="text-align: right;">{{ bill.previous_reading }} m¬≥</td></tr>
                <tr><td colspan="2"><hr style="border: 0; border-top: 1px solid #3498db; margin: 10px 0;"></td></tr>
                <tr style="font-weight: bold;"><td>Consumption:</td><td style="text-align: right;">{{ bill.consumption }} m¬≥</td></tr>
            </table>
        </div>

        <table class="table-main" style="border: none;">
            <tr>
                <td>Current Charge:</td>
                <td style="text-align: right; font-weight: bold;">Php {{ bill.total_amount|floatformat:2|intcomma }}</td>
            </tr>
            {% if unpaid_total > 0 %}
            <tr style="color: #e74c3c;">
                <td>Previous Unpaid ({{ unpaid_count }} bills):</td>
                <td style="text-align: right; font-weight: bold;">Php {{ unpaid_total|floatformat:2|intcomma }}</td>
            </tr>
            {% endif %}
        </table>

        <div class="total-section">
            <span>TOTAL DUE:</span>
            <span>Php {{ grand_total|floatformat:2|intcomma }}</span>
        </div>

        <p style="text-align: center; font-size: 14px; color: #888; margin-top: 40px; font-style: italic;">
            "Payment due within 10 days of receipt. Thank you!"
        </p>
    </div>

    <div class="btn-container no-print">
        <button class="print-button" onclick="window.print()">Print Receipt</button>
        <br><br>
        <a href="/" style="color: #777; text-decoration: none; font-size: 14px;">‚Üê Back to Dashboard</a>
    </div>




<script>
    window.onload = function() {
        window.print();
        window.onafterprint = function() { 
            window.close(); 
        };
    };
</script>

  
</body>
</html>>
